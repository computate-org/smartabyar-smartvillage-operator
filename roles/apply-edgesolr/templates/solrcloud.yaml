spec:
  replicas: {{ values.solr.replicas }}
  busyBoxImage:
    repository: docker.io/library/busybox
    tag: 1.36.0-glibc
  solrImage:
    repository: docker.io/library/solr
    tag: 9.3.0
  dataStorage:
    persistent:
      pvcTemplate:
        spec:
          resources:
            requests:
              storage: {{ values.solr.storage }}
  customSolrKubeOptions:
    podOptions:
      podSecurityContext:
        runAsNonRoot: true
        runAsUser: 8983
        fsGroup: 8983
        seccompProfile:
          type: RuntimeDefault
        allowPrivilegeEscalation: false
      serviceAccountName: solr
      resources:
        limits:
          memory: '{{ values.solr.resources.limits.memory }}'
          cpu: '{{ values.solr.resources.limits.cpu }}'
        requests:
          memory: '{{ values.solr.resources.requests.memory }}'
          cpu: '{{ values.solr.resources.requests.cpu }}'
{% if values.solr.configsets %}
      volumes:
{% for configset in values.solr.configsets %}
        - name: "{{ configset.configmap }}"
          source:
            configMap:
              defaultMode: 440
              name: "{{ configset.configmap }}"
          defaultContainerMount:
              mountPath: "/opt/solr/server/solr/configsets/{{ configset.name }}/conf"
              name: "{{ configset.configmap }}"
{% endfor %}
{% endif %}
  zookeeperRef:
    provided:
      replicas: {{ values.zookeeper.replicas }}
      persistence:
        spec:
          resources:
            requests:
              storage: {{ values.zookeeper.storage }}
      zookeeperPodPolicy:
        resources:
          limits:
            memory: '{{ values.zookeeper.resources.limits.memory }}'
            cpu: '{{ values.zookeeper.resources.limits.cpu }}'
          requests:
            memory: '{{ values.zookeeper.resources.requests.memory }}'
            cpu: '{{ values.zookeeper.resources.requests.cpu }}'
